import pandas as pd

# Step 1: Prepare Future Data Using a 5-Year Rolling Window
future_predictions = []

for target_year in range(2023, 2029):  # Predict for 2023-2028
    train_start = target_year - 5  # Use past 5 years of data
    train_end = target_year - 1

    # Get data for the past 5 years
    past_5_years_df = final_df[(final_df["year"] >= train_start) & (final_df["year"] <= train_end)]

    # Aggregate features: Take means over past 5 years
    aggregated_features = past_5_years_df.groupby("ZCTA")[selected_features].mean().reset_index()

    # Store the target year
    aggregated_features["year"] = target_year

    # Predict Gentrification
    X_future = aggregated_features[selected_features]
    aggregated_features["predicted_gentrification"] = rf_model.predict(X_future)

    # Store results
    future_predictions.append(aggregated_features)

# Step 2: Combine All Predictions
future_predictions_df = pd.concat(future_predictions, ignore_index=True)

# Step 3: Save Predictions
future_predictions_df.to_csv("gentrification_predictions_2023_2028.csv", index=False)

print("Predictions saved: gentrification_predictions_2023_2028.csv")
